
## CENTOS 
#yum -y install git java maven yum-utils
#yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
#yum-config-manager --add-repo  https://download.docker.com/linux/rhel/docker-ce.repo
#yum -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin
#ln -s /usr/libexec/docker/cli-plugins/docker-compose /usr/local/bin/
#systemctl start docker

## UBUNTU
#apt-get update
apt-get install git
#apt-get install jdk*
#apt-get install maven
#update-alternatives --config java
#apt install docker*

#usermod -a -G docker <user>

export SR_ROOT=/root
export SR_DIR=${SR_ROOT}/selective-reprocessing

cd ${SR_ROOT}
git clone https://github.com/doc-ti/selective-reprocessing.git

mkdir flume-input

cd ${SR_DIR}/java-flume
mvn clean install -Dmaven.wagon.http.ssl.insecure=true

cd ${SR_DIR}/java-storm
mvn clean install assembly:single -Dmaven.wagon.http.ssl.insecure=true

cd ${SR_DIR}
ln -s ../java-flume/target/plugin-flume-1.0.0.jar flume-conf/
ln -s ../java-storm/target/storm-test-1.2.2-dep.jar storm/

cd ${SR_DIR}
docker-compose up -d

FFF=data_`date +%Y%m%d_%H%M%S`
export BASE=$RANDOM
for NN in `seq $BASE $((BASE+9))`
do
  echo $NN,$RANDOM
done > $FFF
ls -l $FFF
mv $FFF flume-input/

docker exec -it kafka kafka-console-consumer.sh --bootstrap-server kafka:9092 --topic topic_data --from-beginning

docker exec -it mysql mysql -u root -prootpass -e "select * from info_files;" mydatabase 

docker exec -it supervisor storm jar /tmp/storm-test-1.2.2-dep.jar LoadTopology /tmp/topology.properties topology-load-data
docker exec -it supervisor storm kill  topology-load-data -w 5

docker exec -it supervisor bash



